(()=>{"use strict";var e;!function(e){e[e.NumericLiteral=0]="NumericLiteral",e[e.Program=1]="Program",e[e.BinaryExpr=2]="BinaryExpr",e[e.Identifier=3]="Identifier",e[e.VariableDecleration=4]="VariableDecleration",e[e.AssignmentExpr=5]="AssignmentExpr",e[e.StringLiteral=6]="StringLiteral",e[e.FunctionCallExpr=7]="FunctionCallExpr",e[e.ReturnStmt=8]="ReturnStmt",e[e.UnaryExpr=9]="UnaryExpr",e[e.ArrayValExpr=10]="ArrayValExpr",e[e.IfStmt=11]="IfStmt",e[e.WhileStmt=12]="WhileStmt",e[e.ArrayDecleration=13]="ArrayDecleration",e[e.ObjectDecleration=14]="ObjectDecleration",e[e.ObjectValExpr=15]="ObjectValExpr",e[e.FunctionRef=16]="FunctionRef"}(e||(e={}));class t{constructor(e){this.parent=e,this.variables=new Map}defineVar(e,t){if(this.variables.has(e))throw"Variable already exists";return this.variables.set(e,t),t}findVar(e){if(this.variables.has(e))return this.variables.get(e);if(void 0!==this.parent)return this.parent.findVar(e);throw"Variable does not exist"}setVar(t,r){var n,a,i;if(t.kind===e.Identifier){let e=t;if(void 0!==this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(t,r)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(n=this.variables.get(e.selector))||void 0===n?void 0:n.constant))throw"This variable is constant";this.variables.set(e.selector,r)}else if(t.kind===e.ArrayValExpr){let e=t;if(this.parent){if(!this.variables.has(e.name))return this.parent.setVar(t,r)}else if(!this.variables.has(e.name))throw"This variable does not exist";if(!0===(null===(a=this.variables.get(e.name))||void 0===a?void 0:a.constant))throw"This variable is constant";let n=t,i=this.findVar(n.name);i.value[n.index]=r,this.variables.set(n.name,i)}else if(t.kind===e.ObjectValExpr){let e=t;if(this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(t,r)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(i=this.variables.get(e.selector))||void 0===i?void 0:i.constant))throw"This variable is constant";let n=this.findVar(e.selector),a=!1;n.value.forEach(((t,r)=>{t.key===e.element&&(n.value[r]=t,a=!0)})),a||n.value.push({key:e.selector,value:r}),this.variables.set(e.selector,n)}return r}}class r{constructor(e,t){this.func=e,this.params=t}execute(e,t){this.func(e,t)}}let n,a=new Map;function i(t,r){for(let n of t){if(n.kind===e.ReturnStmt)return l(n.value,r);l(n,r)}return{type:"null",value:"null"}}function l(r,u){switch(r.kind){case e.NumericLiteral:return{type:"number",value:r.value};case e.Program:throw"Program cannot be a node inside the ast and should have been handled if it was at the top";case e.BinaryExpr:return function(e,t){let r=l(e.left,t),n=l(e.right,t);if("=="===e.operator)return r.value===n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("!="===e.operator)return r.value!==n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("number"===r.type&&"number"===n.type)return function(e,t,r){switch(r){case"+":return{type:"number",value:e.value+t.value};case"-":return{type:"number",value:e.value-t.value};case"*":return{type:"number",value:e.value*t.value};case"/":return{type:"number",value:e.value/t.value};case"%":return{type:"number",value:e.value%t.value};case"^":return{type:"number",value:e.value**t.value};case"<":return{type:"boolean",constant:!1,value:e.value<t.value};case">":return{type:"boolean",constant:!1,value:e.value>t.value};default:throw"Invalid Operator"}}(r,n,e.operator);if("string"===r.type&&"string"===n.type)return function(e,t,r){if("+"===r)return{type:"string",value:e.value+t.value};throw"Invalid Operator"}(r,n,e.operator);throw"Cannot evaluate Binary Expression"}(r,u);case e.Identifier:let s=r;return u.findVar(s.selector);case e.VariableDecleration:let c=r;return u.defineVar(c.selector,{type:"null",constant:c.constant,value:"null"});case e.AssignmentExpr:let v=r,d=l(v.value,u);return u.setVar(v.selector,d);case e.StringLiteral:return{type:"string",value:r.value};case e.FunctionCallExpr:return function(e,r){let o=new t(r),u=[];if(n.functions.forEach((t=>{t.name===e.name&&(u=t.func.code)})),void 0===u[0]){let t=a.get(e.name);if(null!==t){let n=new Map;e.params.forEach((e=>{n.set(e.name,l(e.value,r))})),null==t||t.execute(n,r)}}return e.params.forEach((e=>{o.defineVar(e.name,l(e.value,r))})),i(u,o)}(r,u);case e.UnaryExpr:return function(e,t){let r=l(e.expr,t);if("number"===r.type){let t=r;if("++"===e.operator)return{value:t.value+1,constant:!1,type:"number"};if("--"===e.operator)return{value:t.value-1,constant:!1,type:"number"};throw"Invalid Operator"}if("boolean"===r.type){let t=r;if("!"===e.operator)return{type:"boolean",constant:!1,value:!t.value};throw"Invalid Operator"}throw"Cannot resolve UnaryExpr"}(r,u);case e.IfStmt:return function(e,t){return!0===l(e.condition,t).value?i(e.code,t):{type:"null",value:"null"}}(r,new t(u));case e.WhileStmt:return o(r,u);case e.ArrayValExpr:return function(e,t){return t.findVar(e.name).value[e.index]}(r,u);case e.ArrayDecleration:let p=r;return u.defineVar(p.selector,{type:"array",constant:!1,value:[]});case e.ObjectDecleration:let f=r;return u.defineVar(f.selector,{type:"object",constant:!1,value:[]});case e.ObjectValExpr:return function(e,t){let r=t.findVar(e.selector),n={type:"null",value:"null"};return r.value.forEach((t=>{t.key===e.element&&(n=t.value)})),n}(r,u);case e.FunctionRef:return{type:"funcref",value:r.func};default:throw"Invalid Statement"}}function o(e,r){let n=new t(r);return!0===l(e.condition,n).value?(i(e.code,n),o(e,n)):{type:"null",value:"null"}}a.set("println",new r((e=>{let t=e.get("val");return console.log(null==t?void 0:t.value),{value:"null",type:"null"}}),["val"])),a.set("execute",new r(((e,t)=>l(e.get("func").value,t)),["func"]));const u={kind:e.Program,functions:[{name:"test",func:{params:["z"],code:[{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.NumericLiteral,value:4},kind:e.BinaryExpr},right:{kind:e.NumericLiteral,value:3},operator:"^"},{kind:e.ReturnStmt,value:{kind:e.UnaryExpr,expr:{kind:e.Identifier,selector:"z"},operator:"++"}}]}},{name:"print",func:{params:["val"],code:[{name:"execute",kind:e.FunctionCallExpr,params:[{name:"func",value:{kind:e.Identifier,selector:"val"}}]}]}}],code:[{kind:e.FunctionCallExpr,name:"print",params:[{name:"val",value:{kind:e.FunctionRef,func:{name:"println",kind:e.FunctionCallExpr,params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello Ref"}}]}}}]},{kind:e.ObjectDecleration,selector:"obj",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.ObjectValExpr,element:"obj",selector:"obj"},value:{kind:e.StringLiteral,value:"Hello Object"}},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.ObjectValExpr,selector:"obj",element:"obj"}}]},{kind:e.ArrayDecleration,selector:"arr",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.ArrayValExpr,index:0,name:"arr"},value:{kind:e.StringLiteral,value:"Hello Array"}},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.ArrayValExpr,index:0,name:"arr"}}]},{kind:e.VariableDecleration,selector:"whiles",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.NumericLiteral,value:5}},{kind:e.WhileStmt,condition:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:0},operator:">"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello from while loop"}}]},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:1},operator:"-"}}]},{kind:e.IfStmt,condition:{kind:e.Identifier,selector:"true"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World from if"}}]}]},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World"}}]},{kind:e.BinaryExpr,operator:"^",left:{kind:e.NumericLiteral,value:10},right:{kind:e.FunctionCallExpr,name:"test",params:[{name:"z",value:{kind:e.NumericLiteral,value:3}}]}},{kind:e.VariableDecleration,selector:"y",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.StringLiteral,value:"Hello"}},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.BinaryExpr,operator:"+",left:{kind:e.Identifier,selector:"y"},right:{kind:e.StringLiteral,value:" There"}}},{kind:e.VariableDecleration,selector:"x",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"x"},value:{kind:e.NumericLiteral,value:10}},{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.AssignmentExpr,value:{kind:e.NumericLiteral,value:3},selector:{kind:e.Identifier,selector:"x"}},kind:e.BinaryExpr},right:{kind:e.Identifier,selector:"x"},operator:"^"}]},s=new t;s.defineVar("null",{type:"null",value:"null",constant:!0}),s.defineVar("true",{type:"boolean",value:!0,constant:!0}),s.defineVar("false",{type:"boolean",value:!1,constant:!0}),function(e,t){n=e,i(e.code,t)}(u,s)})();