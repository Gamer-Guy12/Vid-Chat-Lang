(()=>{"use strict";class e{constructor(e){this.parent=e,this.variables=new Map}defineVar(e,r){if(this.variables.has(e))throw"Variable already exists";return this.variables.set(e,r),r}findVar(e){if(this.variables.has(e))return this.variables.get(e);if(this.parent)return this.parent.findVar(e);throw"Variable does not exist"}setVar(e,r){var t;if(!this.variables.has(e))throw"Variable does not exist";if(!0===(null===(t=this.variables.get(e))||void 0===t?void 0:t.constant))throw"This variable is constant";return this.variables.set(e,r),r}}var r;!function(e){e[e.NumericLiteral=0]="NumericLiteral",e[e.Program=1]="Program",e[e.BinaryExpr=2]="BinaryExpr",e[e.Identifier=3]="Identifier",e[e.VariableDecleration=4]="VariableDecleration",e[e.AssignmentExpr=5]="AssignmentExpr",e[e.StringLiteral=6]="StringLiteral",e[e.FunctionCallExpr=7]="FunctionCallExpr",e[e.ReturnStmt=8]="ReturnStmt",e[e.UnaryExpr=9]="UnaryExpr"}(r||(r={}));let t,a=new Map;function n(e,t){for(let a of e){if(a.kind===r.ReturnStmt)return i(a.value,t);console.log(i(a,t))}return{type:"null",value:"null"}}function i(l,u){switch(l.kind){case r.NumericLiteral:return{type:"number",value:l.value};case r.Program:throw"Program cannot be a node inside the ast and should have been handled if it was at the top";case r.BinaryExpr:return function(e,r){let t=i(e.left,r),a=i(e.right,r);if("number"===t.type&&"number"===a.type)return function(e,r,t){switch(t){case"+":return{type:"number",value:e.value+r.value};case"-":return{type:"number",value:e.value-r.value};case"*":return{type:"number",value:e.value*r.value};case"/":return{type:"number",value:e.value/r.value};case"%":return{type:"number",value:e.value%r.value};case"^":return{type:"number",value:e.value**r.value};default:throw"Invalid Operator"}}(t,a,e.operator);if("string"===t.type&&"string"===a.type)return function(e,r,t){if("+"===t)return{type:"string",value:e.value+r.value};throw"Invalid Operator"}(t,a,e.operator);throw"Cannot evaluate Binary Expression"}(l,u);case r.Identifier:let o=l;return u.findVar(o.selector);case r.VariableDecleration:let s=l;return u.defineVar(s.selector,{type:"null",constant:s.constant,value:"null"});case r.AssignmentExpr:let c=l,v=i(c.value,u);return u.setVar(c.selector,v);case r.StringLiteral:return{type:"string",value:l.value};case r.FunctionCallExpr:return function(r,l){let u=new e(l),o=[];if(t.functions.forEach((e=>{e.name===r.name&&(o=e.func.code)})),void 0===o[0]){let e=a.get(r.name);if(null!==e){let t=new Map;r.params.forEach((e=>{t.set(e.name,i(e.value,l))})),null==e||e.execute(t)}}return r.params.forEach((e=>{u.defineVar(e.name,i(e.value,l))})),n(o,u)}(l,u);case r.UnaryExpr:return function(e,r){let t=i(e.expr,r);if("number"===t.type){let r=t;if("++"===e.operator)return{value:r.value+1,constant:!1,type:"number"};if("--"===e.operator)return{value:r.value-1,constant:!1,type:"number"};throw"Invalid Operator"}if("boolean"===t.type){let r=t;if("!"===e.operator)return{type:"boolean",constant:!1,value:!r.value};throw"Invalid Operator"}throw"Cannot resolve UnaryExpr"}(l,u);default:throw"Invalid Statement"}}a.set("println",new class{constructor(e,r){this.func=e,this.params=r}execute(e){this.func(e)}}((e=>{let r=e.get("val");return console.log(r.value),{value:"null",type:"null"}}),["val"]));const l={kind:r.Program,functions:[{name:"test",func:{params:["z"],code:[{kind:r.BinaryExpr,left:{operator:"+",left:{kind:r.NumericLiteral,value:2},right:{kind:r.NumericLiteral,value:4},kind:r.BinaryExpr},right:{kind:r.NumericLiteral,value:3},operator:"^"},{kind:r.ReturnStmt,value:{kind:r.UnaryExpr,expr:{kind:r.Identifier,selector:"z"},operator:"++"}}]}}],code:[{kind:r.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:r.StringLiteral,value:"Hello World"}}]},{kind:r.BinaryExpr,operator:"^",left:{kind:r.NumericLiteral,value:10},right:{kind:r.FunctionCallExpr,name:"test",params:[{name:"z",value:{kind:r.NumericLiteral,value:3}}]}},{kind:r.VariableDecleration,selector:"y",constant:!1},{kind:r.AssignmentExpr,selector:"y",value:{kind:r.StringLiteral,value:"Hello"}},{kind:r.AssignmentExpr,selector:"y",value:{kind:r.BinaryExpr,operator:"+",left:{kind:r.Identifier,selector:"y"},right:{kind:r.StringLiteral,value:" There"}}},{kind:r.VariableDecleration,selector:"x",constant:!1},{kind:r.AssignmentExpr,selector:"x",value:{kind:r.NumericLiteral,value:10}},{kind:r.BinaryExpr,left:{operator:"+",left:{kind:r.NumericLiteral,value:2},right:{kind:r.AssignmentExpr,value:{kind:r.NumericLiteral,value:3},selector:"x"},kind:r.BinaryExpr},right:{kind:r.Identifier,selector:"x"},operator:"^"}]},u=new e;u.defineVar("null",{type:"null",value:"null",constant:!0}),u.defineVar("true",{type:"boolean",value:!0,constant:!0}),u.defineVar("false",{type:"boolean",value:!1,constant:!0}),function(e,r){t=e,n(e.code,r)}(l,u)})();