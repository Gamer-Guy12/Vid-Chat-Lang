(()=>{"use strict";var e;!function(e){e[e.NumericLiteral=0]="NumericLiteral",e[e.Program=1]="Program",e[e.BinaryExpr=2]="BinaryExpr",e[e.Identifier=3]="Identifier",e[e.VariableDecleration=4]="VariableDecleration",e[e.AssignmentExpr=5]="AssignmentExpr",e[e.StringLiteral=6]="StringLiteral",e[e.FunctionCallExpr=7]="FunctionCallExpr",e[e.ReturnStmt=8]="ReturnStmt",e[e.UnaryExpr=9]="UnaryExpr",e[e.ArrayValExpr=10]="ArrayValExpr",e[e.IfStmt=11]="IfStmt",e[e.WhileStmt=12]="WhileStmt",e[e.ArrayDecleration=13]="ArrayDecleration",e[e.ObjectDecleration=14]="ObjectDecleration",e[e.ObjectValExpr=15]="ObjectValExpr"}(e||(e={}));class t{constructor(e){this.parent=e,this.variables=new Map}defineVar(e,t){if(this.variables.has(e))throw"Variable already exists";return this.variables.set(e,t),t}findVar(e){if(this.variables.has(e))return this.variables.get(e);if(void 0!==this.parent)return this.parent.findVar(e);throw"Variable does not exist"}setVar(t,r){var a,n,i;if(t.kind===e.Identifier){let e=t;if(void 0!==this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(t,r)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(a=this.variables.get(e.selector))||void 0===a?void 0:a.constant))throw"This variable is constant";this.variables.set(e.selector,r)}else if(t.kind===e.ArrayValExpr){let e=t;if(this.parent){if(!this.variables.has(e.name))return this.parent.setVar(t,r)}else if(!this.variables.has(e.name))throw"This variable does not exist";if(!0===(null===(n=this.variables.get(e.name))||void 0===n?void 0:n.constant))throw"This variable is constant";let a=t,i=this.findVar(a.name);i.value[a.index]=r,this.variables.set(a.name,i)}else if(t.kind===e.ObjectValExpr){let e=t;if(this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(t,r)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(i=this.variables.get(e.selector))||void 0===i?void 0:i.constant))throw"This variable is constant";let a=this.findVar(e.selector),n=!1;a.value.forEach(((t,r)=>{t.key===e.element&&(a.value[r]=t,n=!0)})),n||a.value.push({key:e.selector,value:r}),this.variables.set(e.selector,a)}return r}}let r,a=new Map;function n(t,r){for(let a of t){if(a.kind===e.ReturnStmt)return i(a.value,r);i(a,r)}return{type:"null",value:"null"}}function i(o,s){switch(o.kind){case e.NumericLiteral:return{type:"number",value:o.value};case e.Program:throw"Program cannot be a node inside the ast and should have been handled if it was at the top";case e.BinaryExpr:return function(e,t){let r=i(e.left,t),a=i(e.right,t);if("=="===e.operator)return r.value===a.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("!="===e.operator)return r.value!==a.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("number"===r.type&&"number"===a.type)return function(e,t,r){switch(r){case"+":return{type:"number",value:e.value+t.value};case"-":return{type:"number",value:e.value-t.value};case"*":return{type:"number",value:e.value*t.value};case"/":return{type:"number",value:e.value/t.value};case"%":return{type:"number",value:e.value%t.value};case"^":return{type:"number",value:e.value**t.value};case"<":return{type:"boolean",constant:!1,value:e.value<t.value};case">":return{type:"boolean",constant:!1,value:e.value>t.value};default:throw"Invalid Operator"}}(r,a,e.operator);if("string"===r.type&&"string"===a.type)return function(e,t,r){if("+"===r)return{type:"string",value:e.value+t.value};throw"Invalid Operator"}(r,a,e.operator);throw"Cannot evaluate Binary Expression"}(o,s);case e.Identifier:let u=o;return s.findVar(u.selector);case e.VariableDecleration:let c=o;return s.defineVar(c.selector,{type:"null",constant:c.constant,value:"null"});case e.AssignmentExpr:let v=o,d=i(v.value,s);return s.setVar(v.selector,d);case e.StringLiteral:return{type:"string",value:o.value};case e.FunctionCallExpr:return function(e,l){let o=new t(l),s=[];if(r.functions.forEach((t=>{t.name===e.name&&(s=t.func.code)})),void 0===s[0]){let t=a.get(e.name);if(null!==t){let r=new Map;e.params.forEach((e=>{r.set(e.name,i(e.value,l))})),null==t||t.execute(r)}}return e.params.forEach((e=>{o.defineVar(e.name,i(e.value,l))})),n(s,o)}(o,s);case e.UnaryExpr:return function(e,t){let r=i(e.expr,t);if("number"===r.type){let t=r;if("++"===e.operator)return{value:t.value+1,constant:!1,type:"number"};if("--"===e.operator)return{value:t.value-1,constant:!1,type:"number"};throw"Invalid Operator"}if("boolean"===r.type){let t=r;if("!"===e.operator)return{type:"boolean",constant:!1,value:!t.value};throw"Invalid Operator"}throw"Cannot resolve UnaryExpr"}(o,s);case e.IfStmt:return function(e,t){return!0===i(e.condition,t).value?n(e.code,t):{type:"null",value:"null"}}(o,new t(s));case e.WhileStmt:return l(o,s);case e.ArrayValExpr:return function(e,t){return t.findVar(e.name).value[e.index]}(o,s);case e.ArrayDecleration:let p=o;return s.defineVar(p.selector,{type:"array",constant:!1,value:[]});case e.ObjectDecleration:let f=o;return s.defineVar(f.selector,{type:"object",constant:!1,value:[]});case e.ObjectValExpr:return function(e,t){let r=t.findVar(e.selector),a={type:"null",value:"null"};return r.value.forEach((t=>{t.key===e.element&&(a=t.value)})),a}(o,s);default:throw"Invalid Statement"}}function l(e,r){let a=new t(r);return!0===i(e.condition,a).value?(n(e.code,a),l(e,a)):{type:"null",value:"null"}}a.set("println",new class{constructor(e,t){this.func=e,this.params=t}execute(e){this.func(e)}}((e=>{let t=e.get("val");return console.log(null==t?void 0:t.value),{value:"null",type:"null"}}),["val"]));const o={kind:e.Program,functions:[{name:"test",func:{params:["z"],code:[{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.NumericLiteral,value:4},kind:e.BinaryExpr},right:{kind:e.NumericLiteral,value:3},operator:"^"},{kind:e.ReturnStmt,value:{kind:e.UnaryExpr,expr:{kind:e.Identifier,selector:"z"},operator:"++"}}]}}],code:[{kind:e.ObjectDecleration,selector:"obj",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.ObjectValExpr,element:"obj",selector:"obj"},value:{kind:e.StringLiteral,value:"Hello Object"}},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.ObjectValExpr,selector:"obj",element:"obj"}}]},{kind:e.ArrayDecleration,selector:"arr",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.ArrayValExpr,index:0,name:"arr"},value:{kind:e.StringLiteral,value:"Hello Array"}},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.ArrayValExpr,index:0,name:"arr"}}]},{kind:e.VariableDecleration,selector:"whiles",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.NumericLiteral,value:5}},{kind:e.WhileStmt,condition:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:0},operator:">"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello from while loop"}}]},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:1},operator:"-"}}]},{kind:e.IfStmt,condition:{kind:e.Identifier,selector:"true"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World from if"}}]}]},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World"}}]},{kind:e.BinaryExpr,operator:"^",left:{kind:e.NumericLiteral,value:10},right:{kind:e.FunctionCallExpr,name:"test",params:[{name:"z",value:{kind:e.NumericLiteral,value:3}}]}},{kind:e.VariableDecleration,selector:"y",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.StringLiteral,value:"Hello"}},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.BinaryExpr,operator:"+",left:{kind:e.Identifier,selector:"y"},right:{kind:e.StringLiteral,value:" There"}}},{kind:e.VariableDecleration,selector:"x",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"x"},value:{kind:e.NumericLiteral,value:10}},{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.AssignmentExpr,value:{kind:e.NumericLiteral,value:3},selector:{kind:e.Identifier,selector:"x"}},kind:e.BinaryExpr},right:{kind:e.Identifier,selector:"x"},operator:"^"}]},s=new t;s.defineVar("null",{type:"null",value:"null",constant:!0}),s.defineVar("true",{type:"boolean",value:!0,constant:!0}),s.defineVar("false",{type:"boolean",value:!1,constant:!0}),function(e,t){r=e,n(e.code,t)}(o,s)})();