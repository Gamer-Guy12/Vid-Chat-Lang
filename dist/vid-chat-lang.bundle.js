(()=>{"use strict";var e;!function(e){e[e.NumericLiteral=0]="NumericLiteral",e[e.Program=1]="Program",e[e.BinaryExpr=2]="BinaryExpr",e[e.Identifier=3]="Identifier",e[e.VariableDecleration=4]="VariableDecleration",e[e.AssignmentExpr=5]="AssignmentExpr",e[e.StringLiteral=6]="StringLiteral",e[e.FunctionCallExpr=7]="FunctionCallExpr",e[e.ReturnStmt=8]="ReturnStmt",e[e.UnaryExpr=9]="UnaryExpr",e[e.ArrayValExpr=10]="ArrayValExpr",e[e.IfStmt=11]="IfStmt",e[e.WhileStmt=12]="WhileStmt"}(e||(e={}));class t{constructor(e){this.parent=e,this.variables=new Map}defineVar(e,t){if(this.variables.has(e))throw"Variable already exists";return this.variables.set(e,t),t}findVar(e){if(this.variables.has(e))return this.variables.get(e);if(this.parent)return this.parent.findVar(e);throw"Variable does not exist"}setVar(t,r){var n;if(t.kind===e.Identifier){let e=t;if(this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(t,r)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(n=this.variables.get(e.selector))||void 0===n?void 0:n.constant))throw"This variable is constant";this.variables.set(e.selector,r)}return r}}let r,n=new Map;function a(t,r){for(let n of t){if(n.kind===e.ReturnStmt)return i(n.value,r);i(n,r)}return{type:"null",value:"null"}}function i(u,o){switch(u.kind){case e.NumericLiteral:return{type:"number",value:u.value};case e.Program:throw"Program cannot be a node inside the ast and should have been handled if it was at the top";case e.BinaryExpr:return function(e,t){let r=i(e.left,t),n=i(e.right,t);if("=="===e.operator)return r.value===n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("!="===e.operator)return r.value!==n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("number"===r.type&&"number"===n.type)return function(e,t,r){switch(r){case"+":return{type:"number",value:e.value+t.value};case"-":return{type:"number",value:e.value-t.value};case"*":return{type:"number",value:e.value*t.value};case"/":return{type:"number",value:e.value/t.value};case"%":return{type:"number",value:e.value%t.value};case"^":return{type:"number",value:e.value**t.value};case"<":return{type:"boolean",constant:!1,value:e.value<t.value};case">":return{type:"boolean",constant:!1,value:e.value>t.value};default:throw"Invalid Operator"}}(r,n,e.operator);if("string"===r.type&&"string"===n.type)return function(e,t,r){if("+"===r)return{type:"string",value:e.value+t.value};throw"Invalid Operator"}(r,n,e.operator);throw"Cannot evaluate Binary Expression"}(u,o);case e.Identifier:let s=u;return o.findVar(s.selector);case e.VariableDecleration:let c=u;return o.defineVar(c.selector,{type:"null",constant:c.constant,value:"null"});case e.AssignmentExpr:let v=u,d=i(v.value,o);return o.setVar(v.selector,d);case e.StringLiteral:return{type:"string",value:u.value};case e.FunctionCallExpr:return function(e,l){let u=new t(l),o=[];if(r.functions.forEach((t=>{t.name===e.name&&(o=t.func.code)})),void 0===o[0]){let t=n.get(e.name);if(null!==t){let r=new Map;e.params.forEach((e=>{r.set(e.name,i(e.value,l))})),null==t||t.execute(r)}}return e.params.forEach((e=>{u.defineVar(e.name,i(e.value,l))})),a(o,u)}(u,o);case e.UnaryExpr:return function(e,t){let r=i(e.expr,t);if("number"===r.type){let t=r;if("++"===e.operator)return{value:t.value+1,constant:!1,type:"number"};if("--"===e.operator)return{value:t.value-1,constant:!1,type:"number"};throw"Invalid Operator"}if("boolean"===r.type){let t=r;if("!"===e.operator)return{type:"boolean",constant:!1,value:!t.value};throw"Invalid Operator"}throw"Cannot resolve UnaryExpr"}(u,o);case e.IfStmt:return function(e,t){return!0===i(e.condition,t).value?a(e.code,t):{type:"null",value:"null"}}(u,new t(o));case e.WhileStmt:return l(u,o);default:throw"Invalid Statement"}}function l(e,r){let n=new t(r);return!0===i(e.condition,n).value?(a(e.code,n),l(e,n)):{type:"null",value:"null"}}n.set("println",new class{constructor(e,t){this.func=e,this.params=t}execute(e){this.func(e)}}((e=>{let t=e.get("val");return void 0===(null==t?void 0:t.value)||console.log(t.value),{value:"null",type:"null"}}),["val"]));const u={kind:e.Program,functions:[{name:"test",func:{params:["z"],code:[{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.NumericLiteral,value:4},kind:e.BinaryExpr},right:{kind:e.NumericLiteral,value:3},operator:"^"},{kind:e.ReturnStmt,value:{kind:e.UnaryExpr,expr:{kind:e.Identifier,selector:"z"},operator:"++"}}]}}],code:[{kind:e.VariableDecleration,selector:"whiles",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.NumericLiteral,value:5}},{kind:e.WhileStmt,condition:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:0},operator:">"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello from while loop"}}]},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:1},operator:"-"}}]},{kind:e.IfStmt,condition:{kind:e.Identifier,selector:"true"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World from if"}}]}]},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World"}}]},{kind:e.BinaryExpr,operator:"^",left:{kind:e.NumericLiteral,value:10},right:{kind:e.FunctionCallExpr,name:"test",params:[{name:"z",value:{kind:e.NumericLiteral,value:3}}]}},{kind:e.VariableDecleration,selector:"y",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.StringLiteral,value:"Hello"}},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.BinaryExpr,operator:"+",left:{kind:e.Identifier,selector:"y"},right:{kind:e.StringLiteral,value:" There"}}},{kind:e.VariableDecleration,selector:"x",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"x"},value:{kind:e.NumericLiteral,value:10}},{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.AssignmentExpr,value:{kind:e.NumericLiteral,value:3},selector:{kind:e.Identifier,selector:"x"}},kind:e.BinaryExpr},right:{kind:e.Identifier,selector:"x"},operator:"^"}]},o=new t;o.defineVar("null",{type:"null",value:"null",constant:!0}),o.defineVar("true",{type:"boolean",value:!0,constant:!0}),o.defineVar("false",{type:"boolean",value:!1,constant:!0}),function(e,t){r=e,a(e.code,t)}(u,o)})();