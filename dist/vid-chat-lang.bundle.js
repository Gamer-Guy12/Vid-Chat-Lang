(()=>{"use strict";var e;!function(e){e[e.NumericLiteral=0]="NumericLiteral",e[e.Program=1]="Program",e[e.BinaryExpr=2]="BinaryExpr",e[e.Identifier=3]="Identifier",e[e.VariableDecleration=4]="VariableDecleration",e[e.AssignmentExpr=5]="AssignmentExpr",e[e.StringLiteral=6]="StringLiteral",e[e.FunctionCallExpr=7]="FunctionCallExpr",e[e.ReturnStmt=8]="ReturnStmt",e[e.UnaryExpr=9]="UnaryExpr",e[e.ArrayValExpr=10]="ArrayValExpr",e[e.IfStmt=11]="IfStmt",e[e.WhileStmt=12]="WhileStmt",e[e.ArrayDecleration=13]="ArrayDecleration"}(e||(e={}));class r{constructor(e){this.parent=e,this.variables=new Map}defineVar(e,r){if(this.variables.has(e))throw"Variable already exists";return this.variables.set(e,r),r}findVar(e){if(this.variables.has(e))return this.variables.get(e);if(void 0!==this.parent)return this.parent.findVar(e);throw"Variable does not exist"}setVar(r,t){var n,a;if(r.kind===e.Identifier){let e=r;if(void 0!==this.parent){if(!this.variables.has(e.selector))return this.parent.setVar(r,t)}else if(!this.variables.has(e.selector))throw"This variable does not exist";if(!0===(null===(n=this.variables.get(e.selector))||void 0===n?void 0:n.constant))throw"This variable is constant";this.variables.set(e.selector,t)}else if(r.kind===e.ArrayValExpr){let e=r;if(this.parent){if(!this.variables.has(e.name))return this.parent.setVar(r,t)}else if(!this.variables.has(e.name))throw"This variable does not exist";if(!0===(null===(a=this.variables.get(e.name))||void 0===a?void 0:a.constant))throw"This variable is constant";let n=r,i=this.findVar(n.name);i.value[n.index]=t,this.variables.set(n.name,i)}return t}}let t,n=new Map;function a(r,t){for(let n of r){if(n.kind===e.ReturnStmt)return i(n.value,t);i(n,t)}return{type:"null",value:"null"}}function i(o,u){switch(o.kind){case e.NumericLiteral:return{type:"number",value:o.value};case e.Program:throw"Program cannot be a node inside the ast and should have been handled if it was at the top";case e.BinaryExpr:return function(e,r){let t=i(e.left,r),n=i(e.right,r);if("=="===e.operator)return t.value===n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("!="===e.operator)return t.value!==n.value?{type:"boolean",value:!0,constant:!1}:{type:"boolean",value:!1,constant:!1};if("number"===t.type&&"number"===n.type)return function(e,r,t){switch(t){case"+":return{type:"number",value:e.value+r.value};case"-":return{type:"number",value:e.value-r.value};case"*":return{type:"number",value:e.value*r.value};case"/":return{type:"number",value:e.value/r.value};case"%":return{type:"number",value:e.value%r.value};case"^":return{type:"number",value:e.value**r.value};case"<":return{type:"boolean",constant:!1,value:e.value<r.value};case">":return{type:"boolean",constant:!1,value:e.value>r.value};default:throw"Invalid Operator"}}(t,n,e.operator);if("string"===t.type&&"string"===n.type)return function(e,r,t){if("+"===t)return{type:"string",value:e.value+r.value};throw"Invalid Operator"}(t,n,e.operator);throw"Cannot evaluate Binary Expression"}(o,u);case e.Identifier:let s=o;return u.findVar(s.selector);case e.VariableDecleration:let c=o;return u.defineVar(c.selector,{type:"null",constant:c.constant,value:"null"});case e.AssignmentExpr:let d=o,v=i(d.value,u);return u.setVar(d.selector,v);case e.StringLiteral:return{type:"string",value:o.value};case e.FunctionCallExpr:return function(e,l){let o=new r(l),u=[];if(t.functions.forEach((r=>{r.name===e.name&&(u=r.func.code)})),void 0===u[0]){let r=n.get(e.name);if(null!==r){let t=new Map;e.params.forEach((e=>{t.set(e.name,i(e.value,l))})),null==r||r.execute(t)}}return e.params.forEach((e=>{o.defineVar(e.name,i(e.value,l))})),a(u,o)}(o,u);case e.UnaryExpr:return function(e,r){let t=i(e.expr,r);if("number"===t.type){let r=t;if("++"===e.operator)return{value:r.value+1,constant:!1,type:"number"};if("--"===e.operator)return{value:r.value-1,constant:!1,type:"number"};throw"Invalid Operator"}if("boolean"===t.type){let r=t;if("!"===e.operator)return{type:"boolean",constant:!1,value:!r.value};throw"Invalid Operator"}throw"Cannot resolve UnaryExpr"}(o,u);case e.IfStmt:return function(e,r){return!0===i(e.condition,r).value?a(e.code,r):{type:"null",value:"null"}}(o,new r(u));case e.WhileStmt:return l(o,u);case e.ArrayValExpr:return function(e,r){return r.findVar(e.name).value[e.index]}(o,u);case e.ArrayDecleration:let p=o;return u.defineVar(p.selector,{type:"array",constant:!1,value:[]});default:throw"Invalid Statement"}}function l(e,t){let n=new r(t);return!0===i(e.condition,n).value?(a(e.code,n),l(e,n)):{type:"null",value:"null"}}n.set("println",new class{constructor(e,r){this.func=e,this.params=r}execute(e){this.func(e)}}((e=>{let r=e.get("val");return console.log(null==r?void 0:r.value),{value:"null",type:"null"}}),["val"]));const o={kind:e.Program,functions:[{name:"test",func:{params:["z"],code:[{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.NumericLiteral,value:4},kind:e.BinaryExpr},right:{kind:e.NumericLiteral,value:3},operator:"^"},{kind:e.ReturnStmt,value:{kind:e.UnaryExpr,expr:{kind:e.Identifier,selector:"z"},operator:"++"}}]}}],code:[{kind:e.ArrayDecleration,selector:"arr",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.ArrayValExpr,index:0,name:"arr"},value:{kind:e.StringLiteral,value:"Hello Array"}},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.ArrayValExpr,index:0,name:"arr"}}]},{kind:e.VariableDecleration,selector:"whiles",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.NumericLiteral,value:5}},{kind:e.WhileStmt,condition:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:0},operator:">"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello from while loop"}}]},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"whiles"},value:{kind:e.BinaryExpr,left:{kind:e.Identifier,selector:"whiles"},right:{kind:e.NumericLiteral,value:1},operator:"-"}}]},{kind:e.IfStmt,condition:{kind:e.Identifier,selector:"true"},code:[{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World from if"}}]}]},{kind:e.FunctionCallExpr,name:"println",params:[{name:"val",value:{kind:e.StringLiteral,value:"Hello World"}}]},{kind:e.BinaryExpr,operator:"^",left:{kind:e.NumericLiteral,value:10},right:{kind:e.FunctionCallExpr,name:"test",params:[{name:"z",value:{kind:e.NumericLiteral,value:3}}]}},{kind:e.VariableDecleration,selector:"y",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.StringLiteral,value:"Hello"}},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"y"},value:{kind:e.BinaryExpr,operator:"+",left:{kind:e.Identifier,selector:"y"},right:{kind:e.StringLiteral,value:" There"}}},{kind:e.VariableDecleration,selector:"x",constant:!1},{kind:e.AssignmentExpr,selector:{kind:e.Identifier,selector:"x"},value:{kind:e.NumericLiteral,value:10}},{kind:e.BinaryExpr,left:{operator:"+",left:{kind:e.NumericLiteral,value:2},right:{kind:e.AssignmentExpr,value:{kind:e.NumericLiteral,value:3},selector:{kind:e.Identifier,selector:"x"}},kind:e.BinaryExpr},right:{kind:e.Identifier,selector:"x"},operator:"^"}]},u=new r;u.defineVar("null",{type:"null",value:"null",constant:!0}),u.defineVar("true",{type:"boolean",value:!0,constant:!0}),u.defineVar("false",{type:"boolean",value:!1,constant:!0}),function(e,r){t=e,a(e.code,r)}(o,u)})();